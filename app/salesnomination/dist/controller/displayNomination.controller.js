sap.ui.define(["sap/ui/Device","sap/ui/core/Fragment","sap/ui/core/mvc/Controller","sap/ui/model/json/JSONModel","sap/m/Popover","sap/m/Button","sap/m/library","sap/viz/ui5/controls/common/feeds/FeedItem","sap/viz/ui5/data/FlattenedDataset","sap/m/MessageBox","sap/m/MessageToast","external/ChartJSAdapterDateFns","external/ChartJS","com/ingenx/nomination/salesnomination/utils/HelperFunction"],function(e,t,o,s,a,i,n,l,r,d,c,u,m,y){"use strict";let g=undefined;let h=undefined;let b;let v;return o.extend("com.ingenx.nomination.salesnomination.controller.displayNomination",{onInit:function(){b=this.getView();var e=new s({pane1:"200px",pane2:"auto",pane3:"auto"});b.setModel(e,"sizes");const t={DeliveryPoints:[{DeliveryPt:"",DNQ:"",UOM:"",FromT:"",ToT:"",Event:""}]};const o={RedeliveryPoints:[{RedeliveryPt:"",DNQ:"",UOM:"",FromT:"",ToT:"",Event:""}]};const a=new sap.ui.model.json.JSONModel(t);const i=new sap.ui.model.json.JSONModel(o);this.getView().setModel(a,"DelvModelData");this.getView().setModel(i,"RedlvModelData");var n=new sap.ui.model.json.JSONModel({CummDNQ:""});this.getView().setModel(n,"localModel");const l=this.byId("IdRePubNomGasDayPicker");const r=new Date;const d=new Date(r);d.setDate(r.getDate()+1);l.setMinDate(d)},onRootContainerResize:function(e){var t=e.getParameter("oldSizes"),o=e.getParameter("newSizes"),s="Root container is resized.";if(t&&t.length){s+="\nOld panes sizes = ["+t+"]"}s+="\nNew panes sizes = ["+o+"]"},onInnerContainerResize:function(e){var t=e.getParameter("oldSizes"),o=e.getParameter("newSizes"),s="Inner container is resized.";if(t&&t.length){s+="\nOld panes sizes = ["+t+"]"}s+="\nNew panes sizes = ["+o+"]"},onLoadContractModel:async function(){let e=new sap.ui.model.json.JSONModel;b.setModel(e,"salesContractData")},soldToPartyValueHelp:async function(e){try{let t="_soldTopartySelectDialog";let o="com.ingenx.nomination.salesnomination.fragment.soldToParty";this._currentValueHelpSource=e.getSource();await y._openValueHelpDialog(this,t,o)}catch(e){console.error("Error opening value help dialog:",e);sap.m.MessageBox.error("Could not open value help. Please contact support.")}},onValueHelpConfirmSTP:async function(e){try{let t=this._currentValueHelpSource;v=y._valueHelpSelectedValue(e,this,t.getId());if(!v)return;let o=this.getView();o.byId("pubNom_Contracts").setBusy(true);let s=await y._getSingleEntityDataWithParam(this,"getNominationsByCustomer","SoldToParty",v);if(s&&s.length){let e=new sap.ui.model.json.JSONModel({data:s});o.setModel(e,"newModelForContracts");o.getModel("newModelForContracts").refresh();this.byId("datePicker").setVisible(true)}}catch(e){console.error("Unexpected error:",e.message||e);sap.m.MessageBox.error("An unexpected error occurred. Please try again.")}finally{b.byId("pubNom_Contracts").setBusy(false);if(this._customerSelectDialog){let e=this._customerSelectDialog.getBinding("items");if(e){e.filter([])}}}},onValueHelpSearchSTP:function(e){y._valueHelpLiveSearch(e,"Customer","soldToParty",this)},onBackMat:function(){try{this.byId("IdRePubNomStaticListS").setVisible(false);this.byId("IdRePubNomContractRPDCQ").setVisible(true);this.byId("IdRePubNomStaticListfinal").setVisible(true);var e=this.byId("VboxCon");e.setVisible(true);var t=this.byId("VboxMat");t.setVisible(false);const o=this.byId("IdRePubNomDelPointTable");if(o){o.setVisible(false);this.byId("IdRePubNomTableHeaderBarForDelv").setVisible(false)}this.byId("IdDelCummDNQInput").setValue("");this.byId("IdCummDNQInput").setValue("");this.clearMaterialModels()}catch(e){console.error("Error in onBackMat:",e);sap.m.MessageToast.show("An error occurred while processing. Please try again.")}},refreshModels:function(e){e.forEach(e=>{if(e){e.refresh(true)}})},clearMaterialModels:function(){const e=this.getView().getModel("materialModel");const t=this.getView().getModel("contDataModel");const o=this.getView().getModel("RedlvModelData");const s=this.getView().getModel("DelvModelData");if(t){t.setData({})}if(o){o.setProperty("/RedeliveryPoints",[{RedeliveryPt:"",DNQ:"",UOM:"",FromT:"",ToT:"",Event:""}])}if(s){s.setProperty("/DeliveryPoints",[{DeliveryPt:"",DNQ:"",UOM:"",FromT:"06:00:00",ToT:"06:00:00",Event:""}])}if(e){e.setData({})}const a=this.byId("IdRePubNomGasDayPicker");if(a){a.setValue("")}this.byId("IdDelCummDNQInput").setValue("");this.byId("IdCummDNQInput").setValue("");this.byId("IdRePubNomStaticListS").setVisible(false);this.byId("IdRePubNomContractRPDCQ").setVisible(true);this.byId("IdRePubNomStaticListfinal").setVisible(true);this.refreshModels([e,t,o,s])},onSelectContract:function(e){h=e.getSource().getBindingContext("newModelForContracts").getObject();h=h.DocNo;this.fetchNominationsDetails(h,g)},onSelectGasDay:function(e){const t=b.byId("datePicker");let o=t.getDateValue();if(o){const e=sap.ui.core.format.DateFormat.getInstance({pattern:"yyyy-MM-dd"});g=e.format(o);console.log("Selected Date in format YYYY:mm:DD: ",o)}this.fetchNominationsDetails(h,g)},fetchNominationsDetails:async function(e,t){if(!e){sap.m.MessageToast.show("Please select a contract.");return}if(!t){sap.m.MessageToast.show("Please select a date before choosing a contract.");return}const o=this.getView();const s=o.byId("pubNom_Contracts");const a=o.byId("VboxCon");const i=o.byId("VboxMat");s.setBusy(true);a.setVisible(false);i.setVisible(true);let n=this.getOwnerComponent().getModel();try{const s=`/getContractMatDetailsByGasday?DocNo='${encodeURIComponent(e)}'&Gasday=${encodeURIComponent(t)}`;const a=n.bindList(s);const i=await a.requestContexts(0,Infinity);const l=i.map(e=>e.getObject());console.log("aContracts",l);if(!l||l.length===0){sap.m.MessageToast.show("No nominations found for the selected contract.");return}let r=o.getModel("materialModel");if(!r){r=new sap.ui.model.json.JSONModel;o.setModel(r,"materialModel")}r.setProperty("/selectedMaterials",l)}catch(e){console.error("Error fetching contract details:",e.message||e);sap.m.MessageBox.error("Failed to fetch contract details. Please try again later.")}finally{s.setBusy(false)}},onSelectMaterial:async function(e){var t=e.getSource();var o=t.getBindingContext("materialModel");if(o){var s=o.getObject();var a=s.Material;var i=s.RedelivryPoint}const n=`/getRenominationContractData?DocNo='${h}'&Material='${a}'&Redelivery_Point='${i}'&Gasday=${g}`;console.log("sPath",n);let l=this.getOwnerComponent().getModel();const r=l.bindContext(n,null,{});try{const e=await r.requestObject();console.log("Fetched Data:",e.value);const t=new sap.ui.model.json.JSONModel(e.value[0]);this.getView().setModel(t,"contDataModel");var d=this.getView().getModel("localModel");var c=e.value[0].Rpdnq||"0.000";var u="MBT";d.setProperty("/CummDNQ",c+" "+u);const o=this.getView().byId("IdRePubNomGasDayPicker");if(g){const e=new Date(g);o.setDateValue(e)}else{o.setVisible(false)}const s=e.value[0].Redelivery_Point&&e.value[0].Redelivery_Point.trim()!=="";if(s){this.getView().byId("IdRePubNomContractRPDCQ").setVisible(true);var m=this.getView().getModel("RedlvModelData");var y=m.getProperty("/RedeliveryPoints")||[];y.forEach(t=>{t.RedeliveryPt=e.value[0].Redelivery_Point;t.DNQ=e.value[0].Rpdnq;t.UOM="MBT";t.FromT=e.value[0].Redelivery_ValidFrom;t.ToT=e.value[0].Redelivery_ValidTo;t.Event=e.value[0].Event});m.setProperty("/RedeliveryPoints",y)}const a=!!(e.value[0].Delivery_Point&&e.value[0].Delivery_Point.trim());if(a){var b=this.getView().getModel("DelvModelData");var v=b.getProperty("/DeliveryPoints")||[];this.getView().byId("IdRePubNomStaticListS").setVisible(true);this.getView().byId("IdRePubNomContratRPDCQ").setVisible(true);this.getView().byId("IdRePubNomContractDPDCQ").setVisible(true);this.getView().byId("IdRePubNomContractRPDCQ").setVisible(false);this.getView().byId("IdRePubNomStaticListfinal").setVisible(false);this.getView().byId("IdRePubNomDelPointTable").setVisible(true);v.forEach(t=>{t.DeliveryPt=e.value[0].Delivery_Point;t.UOM="MBT";t.DNQ=e.value[0].Pdnq;t.FromT=e.value[0].Delivery_ValidFrom;t.ToT=e.value[0].Delivery_ValidTo;t.Event=e.value[0].Event});b.setProperty("/DeliveryPoints",v)}}catch(e){console.log("error",e)}}})});
//# sourceMappingURL=displayNomination.controller.js.map