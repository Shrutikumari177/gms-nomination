sap.ui.define(["sap/ui/Device","sap/ui/core/Fragment","sap/ui/core/mvc/Controller","sap/ui/model/json/JSONModel","com/ingenx/nomination/salesnomination/utils/HelperFunction","sap/m/Popover","sap/m/Button","sap/m/library","sap/viz/ui5/controls/common/feeds/FeedItem","sap/viz/ui5/data/FlattenedDataset","sap/m/MessageBox","sap/m/MessageToast","external/ChartJSAdapterDateFns","external/ChartJS"],function(e,t,o,a,r,l,n,i,s,c,u,d,g,p){"use strict";let m;let h=Number.MAX_SAFE_INTEGER;let y=0;let f=0;let M;let V;let v;return o.extend("com.ingenx.nomination.salesnomination.controller.systemNom",{onInit:function(){},soldToPartyValueHelp:async function(e){try{let t="_customerSelectDialog";let o="com.ingenx.nomination.salesnomination.fragment.soldToParty";this._currentValueHelpSource=e.getSource();await r._openValueHelpDialog(this,t,o)}catch(e){console.error("Error opening value help dialog:",e);sap.m.MessageBox.error("Could not open value help. Please contact support.")}},onValueHelpConfirmSTP:async function(e){try{let t=this._currentValueHelpSource;V=r._valueHelpSelectedValue(e,this,t.getId());if(!V)return;let o=this.getView();let a=await r._getSingleEntityDataWithParam(this,"getNominationsByCustomer","SoldToParty",V);if(a&&a.length){let e=new sap.ui.model.json.JSONModel({data:a});o.setModel(e,"newModelForContracts");o.getModel("newModelForContracts").refresh()}}catch(e){console.error("Unexpected error:",e.message||e);sap.m.MessageBox.error("An unexpected error occurred. Please try again.")}finally{this._customerSelectDialog.getBinding("items").filter([])}},onValueHelpSearchSTP:function(e){r._valueHelpLiveSearch(e,"Customer","soldToParty",this)},contractValueHelp:async function(e){try{let t="_contractSelectDialog";let o="com.ingenx.nomination.salesnomination.fragment.selectContract";this._currentValueHelpSource=e.getSource();await r._openValueHelpDialog(this,t,o)}catch(e){console.error("Error opening value help dialog:",e);sap.m.MessageBox.error("Could not open value help. Please contact support.")}},onValueHelpConfirmContract:async function(e){try{let t=this._currentValueHelpSource;let o=r._valueHelpSelectedValue(e,this,t.getId());if(!o){console.error("No contract selected.");return}console.log("Selected Contract:",o);const a=`/getContractDetailsAndPastNom?DocNo=${o}`;console.log("Fetching from path:",a);let l=this.getOwnerComponent().getModel();const n=l.bindContext(a,null,{});try{const e=await n.requestObject();console.log("Fetched Data:",e);if(!e||!e.value||e.value.length===0){console.error("No data received or empty data array!");sap.m.MessageToast.show("No materials found.");return}let t=this.getView();let o=t.getModel("materialModel");if(!o){o=new sap.ui.model.json.JSONModel;t.setModel(o,"materialModel")}o.setProperty("/data",e.value);o.updateBindings(true);o.refresh(true);console.log("Updated Model Data:",o.getData())}catch(e){console.error("Error fetching contract details:",e);sap.m.MessageBox.error("Failed to fetch contract details. Please try again later.")}}catch(e){console.error("Unexpected error:",e);sap.m.MessageBox.error("An unexpected error occurred.")}},onValueHelpSearchContract:function(e){r._valueHelpLiveSearch(e,"DocNo","DocNo",this)},materialValueHelp:async function(e){try{let t="_materialSelectDialog";let o="com.ingenx.nomination.salesnomination.fragment.selectMaterial";this._currentValueHelpSource=e.getSource();await r._openValueHelpDialog(this,t,o)}catch(e){console.error("Error opening value help dialog:",e);sap.m.MessageBox.error("Could not open value help. Please contact support.")}},onValueHelpConfirmMaterial:async function(e){try{let t=this._currentValueHelpSource;let o=r._valueHelpSelectedValue(e,this,t.getId());if(!o)return;let a=e.getParameter("selectedItem");if(!a)return;let l=a.getBindingContext("materialModel");if(!l)return;let n=l.getObject();let i=n.Material;let s=n.Redelivery_Point;let c=n.DocNo;if(!c||!i||!s){sap.m.MessageBox.error("Missing required data: DocNo, Material, or Redelivery_Point.");return}const u=`/getContractDetail?DocNo=${c}&Material=${i}&Redelivery_Point=${s}`;console.log("API Call:",u);let d=this.getOwnerComponent().getModel();let g=d.bindContext(u,null,{});const p=await g.requestObject();console.log("Fetched Contract Data:",p.value);if(!p.value||p.value.length===0){sap.m.MessageBox.warning("No contract details found for the selected material.");return}let m=p.value[0];this.getView().byId("contractRDPDCQ").setValue(m.Redelivery_Dcq||"");this.getView().byId("contractUOM").setValue(m.UOM||"");this.getView().byId("ContractRedeliveryPoint").setValue(m.Redelivery_Point||"")}catch(e){console.error("Error fetching contract details:",e);sap.m.MessageBox.error("Failed to fetch contract details. Please try again.")}},onSubmitSysNomDData:function(){var e=this.getView();var t=this.getOwnerComponent().getModel();var o=t.bindList("/systemNomination");var a={Vbeln:e.byId("registrationMapping_emailID").getValue(),soldToParty:e.byId("registrationMapping_retailerName").getValue(),Material:e.byId("registrationMapping_contactNo").getValue(),Rdcq:parseFloat(e.byId("contractRDPDCQ").getValue())||0,Uom:e.byId("contractUOM").getValue(),RedelivryPoint:e.byId("ContractRedeliveryPoint").getValue(),Rpdnq:parseFloat(e.byId("registrationMapping_district").getValue())||0,ValidTo:e.byId("IdsysPubNomDelvtoTimePicker").getValue(),ValidFrom:e.byId("IdsysPubNomDelvFromTimePicker").getValue()};if(!a.Vbeln){u.error("Contract No. is required!");return}var r=o.create(a);r.created().then(()=>{u.success("System Nomination created successfully!");t.refresh()}).catch(e=>{u.error("Failed to create System Nomination: "+e.message)})}})});
//# sourceMappingURL=systemNom.controller.js.map