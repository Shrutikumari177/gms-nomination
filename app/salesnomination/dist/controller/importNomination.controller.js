sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/model/json/JSONModel","sap/m/MessageBox"],function(e,t,a){"use strict";return e.extend("com.ingenx.nomination.salesnomination.controller.importNomination",{onInit:function(){this.getView().setModel(new t,"excelDataModel");this._loadXLSXLibrary()},_loadXLSXLibrary:function(){var e=document.createElement("script");e.src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.16.9/xlsx.full.min.js";e.type="text/javascript";e.onload=function(){console.log("XLSX library loaded successfully")};document.head.appendChild(e);this.getView().setModel(new t([]),"excelModel")},onFileUpload:function(e){var a=this.getView().byId("importNominationBlockLayoutCell2");var o=e.getSource();var s=o.oFileUpload.files[0];if(!s){sap.m.MessageToast.show("Please select a file first!");return}var l=new FileReader;l.onload=function(e){var o=e.target.result;var s=XLSX.read(o,{type:"binary",cellDates:true});var l=s.SheetNames[0];var n=s.Sheets[l];var i=XLSX.utils.sheet_to_json(n,{raw:false,dateNF:"yyyy-mm-dd hh:mm:ss"});i.forEach(e=>{Object.keys(e).forEach(t=>{if(e[t]instanceof Date){e[t]=XLSX.SSF.format("yyyy-mm-dd hh:mm:ss",e[t])}})});console.log("Parsed Excel Data:",i);if(i.length===0){sap.m.MessageToast.show("No data found in the uploaded file!");return}var r=new t(i);this.getView().setModel(r,"excelModel");console.log("Model Data After Setting:",this.getView().getModel("excelModel").getData());a.setVisible(true);sap.m.MessageToast.show("File uploaded successfully!")}.bind(this);l.readAsBinaryString(s)},handleSave:function(){var e=this.getView().getModel("excelModel");if(!e){sap.m.MessageToast.show("Model not found!");return}var t=e.getData();console.log("Data Retrieved in handleSave:",t);if(!t||t.length===0){sap.m.MessageToast.show("No data to save!");return}let a=this.getOwnerComponent().getModel();let o=a.bindList("/znom_headSet");let s=false;t.forEach(e=>{let t={Gasday:new Date(e.Gasday).toISOString().split("T")[0]+"T00:00:00Z",Vbeln:e.Vbeln.toString(),nomi_toitem:[{Gasday:new Date(e.Gasday).toISOString().split("T")[0]+"T00:00:00Z",Vbeln:e.Vbeln.toString(),ItemNo:e.Posnr,NomItem:"0000000010",Versn:"",DeliveryPoint:e.deliveryPoint,RedelivryPoint:e.Redelivery,ValidTo:e.ValidTo,ValidFrom:e.ValidFrom,Material:e.Material.toString(),Kunnr:"",Auart:"ZGSA",Ddcq:"0.000",Rdcq:"0.000",Uom1:e.Uom,Pdnq:e.Pdnq,Event:""}]};console.log("Posting payload:",t);try{o.create(t,true)}catch(t){console.error("Error saving data for item:",e,t);s=true}});if(s){sap.m.MessageBox.error("Some data could not be saved. Please check logs.")}else{sap.m.MessageBox.success("Nomination Created Successfully.")}}})});
//# sourceMappingURL=importNomination.controller.js.map